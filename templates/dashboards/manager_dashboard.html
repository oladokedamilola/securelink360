{% extends "user_base.html" %}

{% block title %}Manager Dashboard{% endblock %}

{% block extra_css %}
<style>
  .dashboard-wrapper { background-color: #f5f7fb; min-height: 100vh; padding: 1.5rem; }

  /* Profile card */
  .profile-card {
      background: #fff;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 14px rgba(0,0,0,0.08);
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      gap: 1rem;
  }
  .profile-card .avatar {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: #6A1B9A;
      color: #fff;
      font-weight: 700;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
  }
  .profile-card .info h4 { margin: 0; font-size: 1.2rem; font-weight: 600; }
  .profile-card .info p { margin: 0; font-size: .9rem; color: #555; }

  /* Onboarding widget */
  .onboarding-widget {
      background: #fff;
      border-radius: 1rem;
      box-shadow: 0 4px 14px rgba(0,0,0,0.08);
      padding: 1.5rem;
      margin-bottom: 2rem;
  }
  .onboarding-widget h3 { font-weight: 600; color: #6A1B9A; margin-bottom: 1rem; }
  .checklist { list-style: none; padding: 0; margin: 0 0 1rem 0; }
  .checklist li {
      padding: .6rem 1rem;
      margin-bottom: .5rem;
      border-radius: .5rem;
      background: #f0f2f5;
  }
  .checklist li.done { background: #e8f5e9; color: #388e3c; font-weight: 500; }
  .onboarding-complete {
      padding: .75rem 1rem;
      background: #e8f5e9;
      border-radius: .5rem;
      color: #2e7d32;
      font-weight: 600;
      text-align: center;
  }

  /* Summary cards */
  .summary-cards { margin-bottom: 2rem; }
  .summary-card {
      border-radius: 1rem;
      color: #fff;
      text-align: center;
      padding: 1.5rem 1rem;
      height: 140px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      box-shadow: 0 4px 14px rgba(0,0,0,0.1);
      transition: transform .2s ease, box-shadow .2s ease;
  }
  .summary-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
  .summary-card h3 { font-size: 2rem; font-weight: 700; margin-bottom: .25rem; }
  .summary-card p { margin: 0; font-weight: 500; }

  /* Dashboard grid */
  .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
  }
  .dashboard-grid .card {
      background: #fff;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 14px rgba(0,0,0,0.08);
      transition: transform .2s ease, box-shadow .2s ease;
  }
  .dashboard-grid .card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
  .dashboard-grid .card h4 {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 1rem;
      color: #34495e;
      border-bottom: 1px solid #f0f0f0;
      padding-bottom: .5rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">

<!-- Manager Profile Card -->
<div class="card shadow rounded-4 p-3 user-card">
    <div class="row g-3 align-items-center">
        <div class="col-auto">
            {% if user.profile_image %}
                <img src="{{ user.profile_image.url }}" alt="Profile" class="rounded-circle border border-3" width="80" height="80">
            {% else %}
                <div class="rounded-circle border border-3 d-flex align-items-center justify-content-center bg-secondary text-white"
                     style="width:80px; height:80px; font-size:1.5rem;">
                    {{ user.first_name|first }}{{ user.last_name|first }}
                </div>
            {% endif %}
        </div>
        <div class="col">
            <div class="d-flex align-items-center justify-content-between">
                <h4 class="mb-3">{{ user.get_full_name|default:"Manager" }}</h4>
                <!-- Edit Icon -->
                <a href="#" data-bs-toggle="modal" data-bs-target="#editProfileModal"
                   class="text-muted ms-2" data-bs-toggle="tooltip" title="Edit Profile">
                    <i class="fas fa-pen"></i>
                </a>
            </div>
            <div class="user-details-grid">
                <div class="user-detail-item"><strong>Email:</strong> {{ user.email }}</div>
                <div class="user-detail-item"><strong>Role:</strong> Manager</div>
                <div class="user-detail-item"><strong>Status:</strong>
                    <span class="badge bg-success">Active</span>
                </div>
            </div>
        </div>
    </div>
</div>


  <!-- Onboarding Checklist -->
  <div class="onboarding-widget">
      <h3>üëã Welcome, {{ user.first_name }}!</h3>

      <!-- Progress Bar -->
      <div class="progress mb-3" style="height: 12px;">
          <div class="progress-bar bg-success" role="progressbar"
               style="width: {{ onboarding.percent_complete }}%;"
               aria-valuenow="{{ onboarding.percent_complete }}" aria-valuemin="0" aria-valuemax="100">
              {{ onboarding.percent_complete }}%
          </div>
      </div>

      <!-- Checklist -->
      <ul class="checklist">
          <li class="{% if onboarding.profile_complete %}done{% endif %}">
              {% if onboarding.profile_complete %}‚úÖ Profile Complete{% else %}üìù Complete Your Profile{% endif %}
          </li>
          <li class="{% if onboarding.device_registered %}done{% endif %}">
              {% if onboarding.device_registered %}‚úÖ Device Registered{% else %}üíª Register Your Device{% endif %}
          </li>
          <li class="{% if onboarding.mfa_enabled %}done{% endif %}">
              {% if onboarding.mfa_enabled %}‚úÖ MFA Enabled{% else %}üîí Enable MFA{% endif %}
          </li>
      </ul>

      {% if onboarding.complete %}
          <div class="onboarding-complete">üéâ All onboarding steps complete!</div>
      {% endif %}
  </div>

  <!-- Summary Cards -->
  <div class="row g-3 summary-cards">
    <div class="col-6 col-md-3">
      <div class="summary-card" style="background: linear-gradient(135deg, #4CAF50, #66BB6A);">
        <h3>{{ team_members|length }}</h3>
        <p>Team Members</p>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="summary-card" style="background: linear-gradient(135deg, #2196F3, #64B5F6);">
        <h3>{{ team_devices|length }}</h3>
        <p>Team Devices</p>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="summary-card" style="background: linear-gradient(135deg, #FF9800, #FFB74D);">
        <h3>{{ team_alerts|length }}</h3>
        <p>Team Alerts</p>
      </div>
    </div>
  </div>

  <!-- Dashboard Grid -->
  <div class="dashboard-grid">
      <div class="card">
          <h4>üë• Team Members</h4>
          <ul>
              {% for member in team_members %}
                  <li>
                      {{ member.name }} ‚Äì
                      {% if member.onboarding_complete %}
                          <span class="badge bg-success">Onboarded</span>
                      {% else %}
                          <span class="badge bg-warning text-dark">In Progress</span>
                      {% endif %}
                  </li>
              {% empty %}
                  <li>No team members assigned yet.</li>
              {% endfor %}
          </ul>
      </div>
      <div class="card">
          <h4>üíª Team Devices</h4>
          <ul>
              {% for device in team_devices %}
                  <li>{{ device.user.name }} ‚Äì {{ device.name }} ({{ device.ip_address }})</li>
              {% empty %}
                  <li>No devices registered for your team yet.</li>
              {% endfor %}
          </ul>
      </div>
      <div class="card">
          <h4>‚ö†Ô∏è Team Alerts</h4>
          <ul>
              {% for alert in team_alerts %}
                  <li>[{{ alert.timestamp|date:"M d, H:i" }}] {{ alert.user.name }} ‚Äì {{ alert.message }}</li>
              {% empty %}
                  <li>No alerts for your team üéâ</li>
              {% endfor %}
          </ul>
      </div>
      <div class="card">
          <h4>üì¢ Announcements</h4>
          <ul>
              {% for note in announcements %}
                  <li>{{ note.message }} <small>({{ note.date|date:"M d" }})</small></li>
              {% empty %}
                  <li>No announcements at this time.</li>
              {% endfor %}
          </ul>
      </div>
  </div>
</div>
{% endblock %}
